var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{JF:()=>c,oL:()=>d,hM:()=>u,$Z:()=>h});class s{constructor(e,t=[]){this.element=document.createElement(e),this.classList=this.element.classList,this.style=this.element.style,this.dataset=this.element.dataset,this.childNodes=this.element.childNodes,this.children=this.element.children;for(const e of t)if(e.length>0)try{this.element.classList.add(e.replace(/\s/g,"-"))}catch(e){console.log(e)}}append(...e){return this.element.append(...e.map((e=>e instanceof s?e.element:e))),this}prepend(...e){return this.element.prepend(...e.map((e=>e instanceof s?e.element:e))),this}after(...e){return this.element.after(...e.map((e=>e instanceof s?e.element:e))),this}before(...e){return this.element.before(...e.map((e=>e instanceof s?e.element:e))),this}setText(e){return this.element.textContent=e,this}setHTML(e){return this.element.innerHTML=e,this}scrollBy(e){return this.element.scrollBy(e),this}scrollIntoView(e){return this.element.scrollIntoView(e),this}getBoundingClientRect(){return this.element.getBoundingClientRect()}getClientRects(){return this.element.getClientRects()}setAttribute(e,t){try{this.element.setAttribute(e,t)}catch(e){console.log(e)}return this}removeAttribute(e){return this.element.removeAttribute(e),this}getAttribute(e){return this.element.getAttribute(e)}hasAttribute(e){return this.element.hasAttribute(e)}}class i extends s{constructor(e=[]){super("div",e)}addEventListener(e,t,s){return this.element.addEventListener(e,t,s),this}}class n extends i{constructor(e,t,s=[]){super([e,t].concat(s)),this.name=e,this.type=t,this.element.dataset.name=e}}class a extends n{constructor(e,t=[]){super(e,"checkbox",["show icon"].concat(t))}}class r extends n{constructor(e,t,s,n,a=!1,r=3,l=!1,o=[]){super(e,"number bar",o),this.min=t,this.value=s,this.max=n,this.log=a,this.fractionDigits=r,this.isStatic=l,this.valEle=new i(["value"]),this.track=new i(["track"]),this.bar=new i(["bar"]),this.inputListeners=[],a&&(this.min=Math.log(t),this.value=Math.log(s),this.max=Math.log(n)),this.append(this.track.append(this.bar)).append(this.valEle),this.track.addEventListener("click",(async e=>{l||(this.value=this.min+(this.max-this.min)*(e.offsetX/this.track.element.offsetWidth),this.renderBar(),await this.listen())})),this.renderBar()}renderBar(){const e=100*this.getRate()+"%";this.bar.style.background=`linear-gradient(to right, var(--color-variable) ${e}, var(--color-area) ${e})`,this.renderValue()}renderValue(){const e=Math.pow(10,this.fractionDigits);this.valEle.setText((Math.round(this.getValue()*e)/e).toString())}async listen(){for(const e of this.inputListeners)await e(this.getValue())}setMin(e){this.log&&(e=Math.log(e)),(e>this.value||!isFinite(e))&&(e=this.value),this.min=e,this.renderBar()}setValue(e){(e=this.log?Math.log(e):e)<this.min||!isFinite(e)?e=this.min:e>this.max&&(e=this.max),this.value=e,this.renderBar()}setMax(e){this.log&&(e=Math.log(e)),(e<this.value||!isFinite(e))&&(e=this.value),this.max=e,this.renderBar()}getRate(){return this.max<=this.min?0:(this.value-this.min)/(this.max-this.min)}getValue(){return this.log?Math.exp(this.value):this.value}async inputValue(e){this.setValue(e),await this.listen()}async changeValue(e){await this.inputValue(this.getValue()+e)}}class l extends r{constructor(e,t=0,s=0,i=!1,n=[]){super(e,0,t,s,!1,0,i,n)}renderValue(){this.valEle.setText(l.prettyTime(this.value)+"/"+l.prettyTime(this.max))}static prettyTime(e){const t=Math.floor(e%3600/60).toString().padStart(2,"0")+":"+Math.floor(e%60).toString().padStart(2,"0");return e<=3600?t:Math.floor(e/3600).toString()+":"+t}}const o=[];function h(){for(const{element:e}of o){const{top:t,height:s}=e.getBoundingClientRect(),i=t+s/2;if(i>=0&&i<=window.visualViewport.height)return document.documentElement.classList.add("showing"),void e.scrollIntoView()}}function c(){document.documentElement.classList.remove("showing")}function d(e=!1){addEventListener("keydown",(async t=>{if(e&&"Enter"===t.key)h();else if(e&&"Escape"===t.key)c();else for(const{element:e,listener:s}of o){const{top:i,height:n}=e.getBoundingClientRect(),a=i+n/2;if(a>=0&&a<=window.visualViewport.height)return void await s(t)}}))}const u=async(e,t)=>{const s=new i,n=document.createElement("video"),h=new i(["tool bar","hide"]),c={time:new l("time",0),speed:new r("speed",.2,1,5,!0),brightness:new r("brightness",.1,1,10,!0)},d={play:new a("play")};s.append(n).append(h.append((new i).append(d.play).append(c.time)).append((new i).append(c.speed).append(c.brightness)));const u=new URLSearchParams(document.location.search),p=e.options.src??u.get("player-src")??document.documentElement.dataset.playerSrc??"";"string"==typeof p&&p.length>0&&(n.src=p);const m=Number(e.options.time??u.get("player-time")??document.documentElement.dataset.playerTime??"");m>0&&(n.currentTime=m),c.time.inputListeners.push((async e=>{const{seekable:t}=n;for(let s=0;s<t.length;s++)if(t.start(s)<=e&&e<=t.end(s))return void(n.currentTime=e)})),c.speed.inputListeners.push((async e=>{n.playbackRate=e})),c.brightness.inputListeners.push((async e=>{n.style.filter=`brightness(${e})`})),d.play.addEventListener("click",(async()=>{d.play.classList.contains("checking")||(d.play.classList.add("checking"),d.play.classList.contains("play")?await n.play():n.pause(),d.play.classList.remove("checking"))})),n.addEventListener("loadedmetadata",(()=>{c.time.setMax(n.duration),s.classList.remove("loading")})),n.addEventListener("playing",(()=>{s.classList.remove("loading")})),n.addEventListener("waiting",(()=>{s.classList.add("loading")})),n.addEventListener("error",(()=>{s.classList.add("error")})),n.addEventListener("play",(()=>{d.play.classList.remove("play"),d.play.classList.add("pause")})),n.addEventListener("pause",(()=>{d.play.classList.add("play"),d.play.classList.remove("pause")})),n.addEventListener("ended",(()=>{d.play.classList.add("play"),d.play.classList.remove("pause")}));let g=0;return n.addEventListener("timeupdate",(()=>{const e=Date.now();e-g<1e3||(g=e,c.time.setValue(n.currentTime))})),n.addEventListener("ratechange",(()=>{c.speed.setValue(n.playbackRate)})),n.addEventListener("click",(()=>{h.classList.toggle("hide")})),o.push({element:n,listener:async e=>" "===e.key?(e.preventDefault(),void d.play.element.click()):"ArrowLeft"===e.key?(e.preventDefault(),void(n.currentTime-=10)):"ArrowRight"===e.key?(e.preventDefault(),void(n.currentTime+=10)):"ArrowUp"===e.key?(e.preventDefault(),void await c.brightness.changeValue(.1)):"ArrowDown"===e.key?(e.preventDefault(),void await c.brightness.changeValue(-.1)):"["===e.key?(e.preventDefault(),void(n.playbackRate=Math.max(.2,n.playbackRate-.1))):"]"===e.key?(e.preventDefault(),void(n.playbackRate=Math.min(5,n.playbackRate+.1))):void 0}),s.element};var p=t.JF,m=t.oL,g=t.hM,y=t.$Z;export{p as exit,m as listen,g as player,y as show};