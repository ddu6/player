var e={650:(e,t)=>{}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,s),a.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};(()=>{s.d(n,{o:()=>h,h:()=>p});class e{constructor(e,t=[]){this.element=document.createElement(e),this.classList=this.element.classList,this.style=this.element.style,this.dataset=this.element.dataset,this.childNodes=this.element.childNodes,this.children=this.element.children;for(const e of t)if(e.length>0)try{this.element.classList.add(e.replace(/\s/g,"-"))}catch(e){console.log(e)}}append(...t){return this.element.append(...t.map((t=>t instanceof e?t.element:t))),this}prepend(...t){return this.element.prepend(...t.map((t=>t instanceof e?t.element:t))),this}after(...t){return this.element.after(...t.map((t=>t instanceof e?t.element:t))),this}before(...t){return this.element.before(...t.map((t=>t instanceof e?t.element:t))),this}setText(e){return this.element.textContent=e,this}setHTML(e){return this.element.innerHTML=e,this}scrollBy(e){return this.element.scrollBy(e),this}scrollIntoView(e){return this.element.scrollIntoView(e),this}getBoundingClientRect(){return this.element.getBoundingClientRect()}getClientRects(){return this.element.getClientRects()}setAttribute(e,t){try{this.element.setAttribute(e,t)}catch(e){console.log(e)}return this}removeAttribute(e){return this.element.removeAttribute(e),this}getAttribute(e){return this.element.getAttribute(e)}hasAttribute(e){return this.element.hasAttribute(e)}}class t extends e{constructor(e=[]){super("div",e)}addEventListener(e,t,s){return this.element.addEventListener(e,t,s),this}}class i extends t{constructor(e,t,s=[]){super([e,t].concat(s)),this.name=e,this.type=t,this.element.dataset.name=e}}class a extends i{constructor(e,t=[]){super(e,"checkbox",["show icon"].concat(t))}}class r extends i{constructor(e,s,n,i,a=!1,r=3,l=!1,o=[]){super(e,"number bar",o),this.min=s,this.value=n,this.max=i,this.log=a,this.fractionDigits=r,this.isStatic=l,this.valEle=new t(["value"]),this.track=new t(["track"]),this.bar=new t(["bar"]),this.inputListeners=[],a&&(this.min=Math.log(s),this.value=Math.log(n),this.max=Math.log(i)),this.append(this.track.append(this.bar)).append(this.valEle),this.track.addEventListener("click",(async e=>{l||(this.value=this.min+(this.max-this.min)*(e.offsetX/this.track.element.offsetWidth),this.renderBar(),await this.listen())})),this.renderBar()}renderBar(){const e=100*this.getRate()+"%";this.bar.style.background=`linear-gradient(to right, var(--color-variable) ${e}, var(--color-area) ${e})`,this.renderValue()}renderValue(){const e=Math.pow(10,this.fractionDigits);this.valEle.setText((Math.round(this.getValue()*e)/e).toString())}async listen(){for(const e of this.inputListeners)await e(this.getValue())}setMin(e){this.log&&(e=Math.log(e)),(e>this.value||!isFinite(e))&&(e=this.value),this.min=e,this.renderBar()}setValue(e){(e=this.log?Math.log(e):e)<this.min||!isFinite(e)?e=this.min:e>this.max&&(e=this.max),this.value=e,this.renderBar()}setMax(e){this.log&&(e=Math.log(e)),(e<this.value||!isFinite(e))&&(e=this.value),this.max=e,this.renderBar()}getRate(){return this.max<=this.min?0:(this.value-this.min)/(this.max-this.min)}getValue(){return this.log?Math.exp(this.value):this.value}async inputValue(e){this.setValue(e),await this.listen()}async changeValue(e){await this.inputValue(this.getValue()+e)}}class l extends r{constructor(e,t=0,s=0,n=!1,i=[]){super(e,0,t,s,!1,0,n,i)}renderValue(){this.valEle.setText(l.prettyTime(this.value)+"/"+l.prettyTime(this.max))}static prettyTime(e){const t=Math.floor(e%3600/60).toString().padStart(2,"0")+":"+Math.floor(e%60).toString().padStart(2,"0");return e<=3600?t:Math.floor(e/3600).toString()+":"+t}}function o(e,t,s){const n=function(e,t,s){const n=s[t];return void 0===n?[]:n[e]??[]}(e,t,s);if(0!==n.length)return n[n.length-1]}s(650);const c=[];function h(e=!1){addEventListener("keydown",(async t=>{if(e&&"Enter"===t.key)!function(){for(const{element:e}of c){const{top:t,height:s}=e.getBoundingClientRect(),n=t+s/2;if(n>=0&&n<=window.visualViewport.height)return document.documentElement.classList.add("showing"),void e.scrollIntoView()}}();else if(e&&"Escape"===t.key)document.documentElement.classList.remove("showing");else for(const{element:e,listener:s}of c){const{top:n,height:i}=e.getBoundingClientRect(),a=n+i/2;if(a>=0&&a<=window.visualViewport.height)return void await s(t)}}))}const d=["autoplay","controls","crossorigin","loop","muted","poster","preload"],p=async(e,s)=>{const n=new t,i=document.createElement("video"),h=new t(["tool bar","hide"]),p={time:new l("time",0),speed:new r("speed",.2,1,5,!0),brightness:new r("brightness",.1,1,10,!0)},u={play:new a("play")};n.append(i).append(h.append((new t).append(u.play).append(p.time)).append((new t).append(p.speed).append(p.brightness)));const m=new URLSearchParams(document.location.search),g=e.options.src??m.get("player-src")??document.documentElement.dataset.playerSrc??"";"string"==typeof g&&g.length>0&&(i.src=g);const v=Number(e.options.time??m.get("player-time")??document.documentElement.dataset.playerTime??"");v>0&&(i.currentTime=v);for(const t of d){let n=e.options[t]??o(t,"player",s.context.tagToGlobalOptions);if(!0===n&&(n=""),"string"==typeof n)try{i.setAttribute(t,n)}catch(e){console.log(e)}}p.time.inputListeners.push((async e=>{const{seekable:t}=i;for(let s=0;s<t.length;s++)if(t.start(s)<=e&&e<=t.end(s))return void(i.currentTime=e)})),p.speed.inputListeners.push((async e=>{i.playbackRate=e})),p.brightness.inputListeners.push((async e=>{i.style.filter=`brightness(${e})`})),u.play.addEventListener("click",(async()=>{u.play.classList.contains("checking")||(u.play.classList.add("checking"),u.play.classList.contains("play")?await i.play():i.pause(),u.play.classList.remove("checking"))})),i.addEventListener("loadedmetadata",(()=>{p.time.setMax(i.duration),n.classList.remove("loading")})),i.addEventListener("playing",(()=>{n.classList.remove("loading")})),i.addEventListener("waiting",(()=>{n.classList.add("loading")})),i.addEventListener("error",(()=>{n.classList.add("error")})),i.addEventListener("play",(()=>{u.play.classList.remove("play"),u.play.classList.add("pause")})),i.addEventListener("pause",(()=>{u.play.classList.add("play"),u.play.classList.remove("pause")})),i.addEventListener("ended",(()=>{u.play.classList.add("play"),u.play.classList.remove("pause")}));let y=0;return i.addEventListener("timeupdate",(()=>{const e=Date.now();e-y<1e3||(y=e,p.time.setValue(i.currentTime))})),i.addEventListener("ratechange",(()=>{p.speed.setValue(i.playbackRate)})),i.addEventListener("click",(()=>{h.classList.toggle("hide")})),c.push({element:i,listener:async e=>" "===e.key?(e.preventDefault(),void u.play.element.click()):"ArrowLeft"===e.key?(e.preventDefault(),void(i.currentTime-=10)):"ArrowRight"===e.key?(e.preventDefault(),void(i.currentTime+=10)):"ArrowUp"===e.key?(e.preventDefault(),void await p.brightness.changeValue(.1)):"ArrowDown"===e.key?(e.preventDefault(),void await p.brightness.changeValue(-.1)):"["===e.key?(e.preventDefault(),void(i.playbackRate=Math.max(.2,i.playbackRate-.1))):"]"===e.key?(e.preventDefault(),void(i.playbackRate=Math.min(5,i.playbackRate+.1))):void 0}),i.append(await s.compileInlineSTDN(e.children)),n.element}})();var i=n.o,a=n.h;export{i as listen,a as player};