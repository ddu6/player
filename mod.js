var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{o:()=>c,h:()=>d});class s{constructor(e,t=[]){this.element=document.createElement(e),this.classList=this.element.classList,this.style=this.element.style,this.dataset=this.element.dataset,this.childNodes=this.element.childNodes,this.children=this.element.children;for(const e of t)if(e.length>0)try{this.element.classList.add(e.replace(/\s/g,"-"))}catch(e){console.log(e)}}append(...e){return this.element.append(...e.map((e=>e instanceof s?e.element:e))),this}prepend(...e){return this.element.prepend(...e.map((e=>e instanceof s?e.element:e))),this}after(...e){return this.element.after(...e.map((e=>e instanceof s?e.element:e))),this}before(...e){return this.element.before(...e.map((e=>e instanceof s?e.element:e))),this}setText(e){return this.element.textContent=e,this}setHTML(e){return this.element.innerHTML=e,this}scrollBy(e){return this.element.scrollBy(e),this}scrollIntoView(e){return this.element.scrollIntoView(e),this}getBoundingClientRect(){return this.element.getBoundingClientRect()}getClientRects(){return this.element.getClientRects()}setAttribute(e,t){try{this.element.setAttribute(e,t)}catch(e){console.log(e)}return this}removeAttribute(e){return this.element.removeAttribute(e),this}getAttribute(e){return this.element.getAttribute(e)}hasAttribute(e){return this.element.hasAttribute(e)}}class i extends s{constructor(e=[]){super("div",e)}addEventListener(e,t,s){return this.element.addEventListener(e,t,s),this}}class n extends i{constructor(e,t,s=[]){super([e,t].concat(s)),this.name=e,this.type=t,this.element.dataset.name=e}}class a extends n{constructor(e,t=[]){super(e,"checkbox",["show icon"].concat(t))}}class r extends n{constructor(e,t,s,n,a=!1,r=3,l=!1,o=[]){super(e,"number bar",o),this.min=t,this.value=s,this.max=n,this.log=a,this.fractionDigits=r,this.isStatic=l,this.valEle=new i(["value"]),this.track=new i(["track"]),this.bar=new i(["bar"]),this.inputListeners=[],a&&(this.min=Math.log(t),this.value=Math.log(s),this.max=Math.log(n)),this.append(this.track.append(this.bar)).append(this.valEle),this.track.addEventListener("click",(async e=>{l||(this.value=this.min+(this.max-this.min)*(e.offsetX/this.track.element.offsetWidth),this.renderBar(),await this.listen())})),this.renderBar()}renderBar(){const e=100*this.getRate()+"%";this.bar.style.background=`linear-gradient(to right, var(--color-variable) ${e}, var(--color-area) ${e})`,this.renderValue()}renderValue(){const e=Math.pow(10,this.fractionDigits);this.valEle.setText((Math.round(this.getValue()*e)/e).toString())}async listen(){for(const e of this.inputListeners)await e(this.getValue())}setMin(e){this.log&&(e=Math.log(e)),(e>this.value||!isFinite(e))&&(e=this.value),this.min=e,this.renderBar()}setValue(e){(e=this.log?Math.log(e):e)<this.min||!isFinite(e)?e=this.min:e>this.max&&(e=this.max),this.value=e,this.renderBar()}setMax(e){this.log&&(e=Math.log(e)),(e<this.value||!isFinite(e))&&(e=this.value),this.max=e,this.renderBar()}getRate(){return this.max<=this.min?0:(this.value-this.min)/(this.max-this.min)}getValue(){return this.log?Math.exp(this.value):this.value}async inputValue(e){this.setValue(e),await this.listen()}async changeValue(e){await this.inputValue(this.getValue()+e)}}class l extends r{constructor(e,t=0,s=0,i=!1,n=[]){super(e,0,t,s,!1,0,i,n)}renderValue(){this.valEle.setText(l.prettyTime(this.value)+"/"+l.prettyTime(this.max))}static prettyTime(e){const t=Math.floor(e%3600/60).toString().padStart(2,"0")+":"+Math.floor(e%60).toString().padStart(2,"0");return e<=3600?t:Math.floor(e/3600).toString()+":"+t}}const o=[];function c(e=!1){addEventListener("keydown",(async t=>{if(e&&"Enter"===t.key)!function(){for(const{element:e}of o){const{top:t,height:s}=e.getBoundingClientRect(),i=t+s/2;if(i>=0&&i<=window.visualViewport.height)return document.documentElement.classList.add("showing"),void e.scrollIntoView()}}();else if(e&&"Escape"===t.key)document.documentElement.classList.remove("showing");else for(const{element:e,listener:s}of o){const{top:i,height:n}=e.getBoundingClientRect(),a=i+n/2;if(a>=0&&a<=window.visualViewport.height)return void await s(t)}}))}const h=["autoplay","controls","crossorigin","loop","muted","poster","preload"],d=async(e,t)=>{const s=new i,n=document.createElement("video"),c=new i(["tool bar","hide"]),d={time:new l("time",0),speed:new r("speed",.2,1,5,!0),brightness:new r("brightness",.1,1,10,!0)},p={play:new a("play")};s.append(n).append(c.append((new i).append(p.play).append(d.time)).append((new i).append(d.speed).append(d.brightness)));const u=new URLSearchParams(document.location.search),m=e.options.src??u.get("player-src")??document.documentElement.dataset.playerSrc??"";"string"==typeof m&&m.length>0&&(n.src=m);const g=Number(e.options.time??u.get("player-time")??document.documentElement.dataset.playerTime??"");g>0&&(n.currentTime=g);for(const t of Object.keys(e.options)){if("src"===t||"time"===t)continue;if(!h.includes(t))continue;let s=e.options[t];if(!0===s&&(s=""),"string"==typeof s)try{n.setAttribute(t,s)}catch(e){console.log(e)}}d.time.inputListeners.push((async e=>{const{seekable:t}=n;for(let s=0;s<t.length;s++)if(t.start(s)<=e&&e<=t.end(s))return void(n.currentTime=e)})),d.speed.inputListeners.push((async e=>{n.playbackRate=e})),d.brightness.inputListeners.push((async e=>{n.style.filter=`brightness(${e})`})),p.play.addEventListener("click",(async()=>{p.play.classList.contains("checking")||(p.play.classList.add("checking"),p.play.classList.contains("play")?await n.play():n.pause(),p.play.classList.remove("checking"))})),n.addEventListener("loadedmetadata",(()=>{d.time.setMax(n.duration),s.classList.remove("loading")})),n.addEventListener("playing",(()=>{s.classList.remove("loading")})),n.addEventListener("waiting",(()=>{s.classList.add("loading")})),n.addEventListener("error",(()=>{s.classList.add("error")})),n.addEventListener("play",(()=>{p.play.classList.remove("play"),p.play.classList.add("pause")})),n.addEventListener("pause",(()=>{p.play.classList.add("play"),p.play.classList.remove("pause")})),n.addEventListener("ended",(()=>{p.play.classList.add("play"),p.play.classList.remove("pause")}));let y=0;return n.addEventListener("timeupdate",(()=>{const e=Date.now();e-y<1e3||(y=e,d.time.setValue(n.currentTime))})),n.addEventListener("ratechange",(()=>{d.speed.setValue(n.playbackRate)})),n.addEventListener("click",(()=>{c.classList.toggle("hide")})),o.push({element:n,listener:async e=>" "===e.key?(e.preventDefault(),void p.play.element.click()):"ArrowLeft"===e.key?(e.preventDefault(),void(n.currentTime-=10)):"ArrowRight"===e.key?(e.preventDefault(),void(n.currentTime+=10)):"ArrowUp"===e.key?(e.preventDefault(),void await d.brightness.changeValue(.1)):"ArrowDown"===e.key?(e.preventDefault(),void await d.brightness.changeValue(-.1)):"["===e.key?(e.preventDefault(),void(n.playbackRate=Math.max(.2,n.playbackRate-.1))):"]"===e.key?(e.preventDefault(),void(n.playbackRate=Math.min(5,n.playbackRate+.1))):void 0}),n.append(await t.compileInlineSTDN(e.children)),s.element};var p=t.o,u=t.h;export{p as listen,u as player};